<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movieopedia</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
  </head>
  <body>
    <div id="app" class="container">
      <div class="bg-info p-5 m-5 rounded">
        <div class="h2 text-center">Learn Vue - Movieopedia</div>
        <hr>
        <div class="input-group mb-3">
          <span class="input-group-text">Title</span>
          <input type="text" name="title" id="title" class="form-control" v-model="newMovie.title">
        </div>
        <div class="input-group mb-3">
          <span class="input-group-text">Year</span>
          <input type="text" name="title" id="title" class="form-control" v-model="newMovie.year">
        </div>
        <div class="text-center pb-3">
          <button class="btn btn-secondary m-2 w-25" @click="addMovie">Add Movie</button>
          <button class="btn btn-danger m-2 w-25" @click="rmvMovie">Remove Movie</button>
        </div>
        <div class="border p-3 w-50 mx-auto">
          <div class="text-center">
            <h4 class="text-center">Movie List</h4>
            <span class="text-danger" v-if="showMessage">You can only add 5 movies</span>
            <hr>
            <ul class="list-group">
              <li v-for="movie in getAllMoviesText" class="list-group-item">{{movie}}</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <script>
      const { createApp, ref, reactive, computed, watch } = Vue

      const app = createApp({
        setup() {
          // console.log("Working")

          const movies = reactive([
            { title: "Lord of the Rings", year: 2001 },
            { title: "Spiderman into the Spiderverse", year: 2021 },
            { title: "Jujutsu Kaisen 0", year: 2022 },
          ])

          const newMovie = reactive({ title: "", year: "" })

          let showMessage = ref(false)

          function addMovie() {
            if (movies.length < 5) {
              movies.push({ ...newMovie })
              newMovie.title = ""
              newMovie.year = ""
            }
          }

          watch(() => movies.length, async () => {
            if (movies.length >= 5) {
              showMessage.value = true
              setTimeout(() => {
                alert("It won't be possible to add a new movie.\nTry and remove a movie before adding another")
              }, 1000)
            } else {
              showMessage.value = false
            }
          })

          function rmvMovie() {
            movies.pop()
          }

          const getAllMoviesText = computed(() => {
            return movies.map((movie) => {
              return `${movie.title} was released in ${movie.year}`
            })
          })

          return {movies, newMovie, showMessage, addMovie, rmvMovie, getAllMoviesText}
        }
      })

      app.mount("#app")
    </script>
  </body>
</html>